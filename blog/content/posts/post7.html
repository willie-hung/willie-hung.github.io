<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog | Query Firestore using TypeScript</title>
    <link rel="icon" href="../../../img/favicon.ico" type="image/x-icon" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
  </head>
  <body>
    <section class="section">
      <div class="container">
        <div class="level">
          <div class="level-left">
            <a href="../index.html"
              ><button class="button is-white">
                <span style="color: #3f3f3f" class="icon"
                  ><i class="fa-solid fa-reply"></i></span
                ><span style="color: #3f3f3f">Back</span>
              </button></a
            >
          </div>
          <div
            class="level-item is-flex is-flex-direction-row is-justify-content-center is-align-items-center"
          >
            <h1 class="title has-text-centered">
              Query Firestore using TypeScript
            </h1>
          </div>
        </div>

        <hr />
        <p class="is-size-3">Objectives</p>
        <div class="box level content">
          <p>
            Learn how to query Firestore data using a simple TypeScript script.
          </p>
        </div>

        <p class="is-size-3">Intro to Firestore Data Model</p>
        <div class="box content">
          <div
            class="is-flex is-flex-direction-row is-justify-content-center is-align-items-center"
          >
            <figure class="image column is-one-third">
              <image src="./figures/post7/figure1.png" />
            </figure>
          </div>
          <ul>
            <li>
              Each <strong>document</strong> contains a set of key-value pairs.
              Cloud Firestore is optimized for storing large collections of
              small documents.
            </li>
            <li>
              All documents must be stored in <strong>collections</strong>.
              Documents can contain subcollections and nested objects, both of
              which can include primitive fields like strings or complex objects
              like lists.
            </li>
            <li>
              Collections and documents are created
              <strong>implicitly</strong> in Cloud Firestore. Simply assign data
              to a document within a collection. If either the collection or
              document does not exist, Cloud Firestore creates it.
            </li>
          </ul>
        </div>

        <p class="is-size-3">
          Create a firebase project and register your web app
        </p>
        <div class="box">
          <p>
            First, follow the
            <a href="https://firebase.google.com/docs/web/setup" target="_blank"
              >firebase documentation</a
            >
            to setup your firebase project. After setting up, you could register
            your web app and add Firebase SDK to your application. You should
            see something like this:
          </p>
          <div
            class="is-flex is-flex-direction-row is-justify-content-center is-align-items-center"
          >
            <figure class="image column is-two-thirds">
              <image src="./figures/post7/figure3.jpg" />
            </figure>
          </div>
          <p>Copy the config information and continue to the next step.</p>

          <script src="https://gist.github.com/Willie-The-Lord/03f7acd6849dad20edb0e95d90d12158.js"></script>
        </div>

        <p class="is-size-3">Initialize the firestore in a TypeScript file</p>
        <div class="box content">
          <p class="is-size-5">Connect to Firestore</p>
          <p>
            Import the necessary functions from the Firebase SDK to initialize
            and access Firestore. Then swap out your firebase config. Next,
            initialize the Firebase app using the provided configuration object
            and assigns it to the variable <strong>app</strong>. After that, use
            the getFirestore function to create a Firestore instance and assigns
            it to the variable <strong>db</strong>. Finally, export the db
            variable, allowing other parts of the code to import and use the
            Firestore instance for database operations.
          </p>
          <script src="https://gist.github.com/Willie-The-Lord/20bf9b273492512b1d8643c1f182d81c.js"></script>

          <p class="is-size-5">Add/Update data field to Firestore</p>
          <ul>
            <li>
              Define an <strong>asynchronous</strong> function called addData
              that takes in parameters for <strong>name</strong>,
              <strong>age</strong>, and <strong>college.</strong>
            </li>
            <li>
              Inside addData, create
              <strong>a reference to a Firestore collection</strong> named
              "test" using the collection function and the db instance.
            </li>
            <li>
              Try to retrieve all the documents in the "test" collection using
              the getDocs function and awaits the result.
            </li>
            <li>
              If successful, iterate over each document and retrieves the
              document ID.
            </li>
            <li>
              Create a document reference using the doc function and the objects
              reference and document ID.
            </li>
            <li>
              Inside the inner try block, update the document with the new
              fields using the updateDoc function and the document reference.
            </li>
            <li>
              If the update is successful, log a success message to the console.
            </li>
          </ul>

          <script src="https://gist.github.com/Willie-The-Lord/e07116206838143ede25e6b5e27355d7.js"></script>
          <p>
            When you run the code and make changes to the documents in the
            Firestore collection, those changes will be reflected immediately in
            the Firebase console. You can observe the updated data in real-time
            as you interact with the Firestore database.
          </p>
          <div class="is-flex is-justify-content-center is-align-items-center">
            <figure class="image column is-two-thirds">
              <image src="./figures/post7/figure2.png" />
            </figure>
          </div>
          <p class="is-size-5">Query Firestore Data: Search</p>
          <script src="https://gist.github.com/Willie-The-Lord/c4fd9ae0a1dec38e9660145209b2d1d9.js"></script>
          <p>Let's walk through the code:</p>
          <ul>
            <li>
              Define an asynchronous function named queryFirestore that takes a
              name parameter.
            </li>
            <li>
              Create a reference to the "test" collection in the Firestore
              database using the collection function.
            </li>
            <li>
              Create a query object using the query function,
              <strong
                >filtering the documents where the "name" field is equal to the
                provided name.</strong
              >
            </li>
            <li>
              Try to execute the query and await the result using the getDocs
              function.
            </li>
            <li>
              If the query result is not empty, retrieve the first document's
              data and log it to the console as a success message.
            </li>
          </ul>
        </div>

        <p class="is-size-3">Conclusion</p>
        <div class="box content">
          <p class="is-size-5">Some advantages of using Firestore</p>
          <ul>
            <li>
              <strong>Real-time data synchronization:</strong> Firestore
              provides real-time data synchronization, allowing multiple clients
              to receive instant updates whenever the data changes. This makes
              it ideal for building collaborative and real-time applications
              like chat apps, collaborative document editing, and real-time
              dashboards.
            </li>
            <li>
              <strong>Flexible data modeling:</strong> Firestore's
              document-oriented data model allows you to structure and organize
              data in a flexible manner. You can use collections and documents
              to represent your data hierarchy, and fields within documents to
              store data attributes. This flexibility makes it easier to adapt
              and evolve your data model as your application requirements change
              over time.
            </li>
            <li>
              <strong>Simple querying and indexing:</strong> Firestore offers
              powerful querying capabilities that allow you to retrieve data
              based on various criteria. You can query data using equality
              filters, range filters, sorting, and even complex compound
              queries. Firestore automatically indexes your data, making queries
              efficient and performant.
            </li>
          </ul>
        </div>

        <p class="is-size-3">Source</p>
        <div class="box content">
          <ul style="padding-bottom: 20px">
            <li>
              <a
                href="https://firebase.google.com/docs/web/setup"
                target="_blank"
                >Firebase Setup Documentation
                <i class="fa-solid fa-arrow-up-right-from-square"></i
              ></a>
            </li>
            <li>
              <a
                href="https://firebase.google.com/docs/firestore/data-model"
                target="_blank"
                >Cloud Firestore Data Model Documentation
                <i class="fa-solid fa-arrow-up-right-from-square"></i
              ></a>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="content has-text-centered">
        <p>
          Written by
          <strong
            ><a href="https://sungjiehung.com/" target="_blank"
              >Sung-Jie Hung</a
            ></strong
          >
          ❤️
        </p>
        <p>Last update: <strong>Jul 13, 2023</strong></p>
      </div>
    </footer>

    <script
      src="https://kit.fontawesome.com/7119540adb.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
